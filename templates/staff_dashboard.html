<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Green Heaven - Staff Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/staff-dashboard.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="dashboard-layout">
        <!-- Navigation Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="brand-section">
                    <img src="{{ url_for('static', filename='logo.png') }}" alt="Green Heaven Logo" class="logo">
                    <div class="brand-text">
                        <h1>Green Heaven</h1>
                        <small>Staff Dashboard</small>
                    </div>
                </div>
            </div>

            <div class="nav-menu">
                <ul class="nav-items">
                    <li class="nav-item active" data-page="overview">
                        <a href="#overview" class="nav-link" data-page="overview">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Overview</span>
                        </a>
                    </li>
                    <li class="nav-item" data-page="tables">
                        <a href="#tables" class="nav-link" data-page="tables">
                            <i class="fas fa-table"></i>
                            <span>Table Management</span>
                            <span class="badge" id="tables-badge">0</span>
                        </a>
                    </li>
                    <li class="nav-item" data-page="orders">
                        <a href="#orders" class="nav-link" data-page="orders">
                            <i class="fas fa-receipt"></i>
                            <span>Orders</span>
                            <span class="badge" id="orders-badge">0</span>
                        </a>
                    </li>
                    <li class="nav-item" data-page="alerts">
                        <a href="#alerts" class="nav-link" data-page="alerts">
                            <i class="fas fa-bell"></i>
                            <span>Customer Calls</span>
                            <span class="badge alert-badge" id="alerts-badge">0</span>
                        </a>
                    </li>
                    <li class="nav-item" data-page="menu">
                        <a href="#menu" class="nav-link" data-page="menu">
                            <i class="fas fa-utensils"></i>
                            <span>Menu Management</span>
                        </a>
                    </li>
                    <li class="nav-item" data-page="analytics">
                        <a href="#analytics" class="nav-link" data-page="analytics">
                            <i class="fas fa-chart-line"></i>
                            <span>Analytics</span>
                        </a>
                    </li>
                    <li class="nav-item" data-page="settings">
                        <a href="#settings" class="nav-link" data-page="settings">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </div>

            <div class="sidebar-footer">
                <div class="staff-info">
                    <i class="fas fa-user-circle"></i>
                    <span>Staff Member</span>
                </div>
                <button class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Header Bar -->
            <header class="top-header">
                <div class="header-left">
                    <button class="menu-toggle" id="menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h2 class="page-title" id="page-title">Restaurant Overview</h2>
                </div>
                <div class="header-right">
                    <div class="notification-center">
                        <button class="notification-btn" id="notification-btn">
                            <i class="fas fa-bell"></i>
                            <span class="notification-count" id="notification-count">0</span>
                        </button>
                    </div>
                    <div class="refresh-btn">
                        <button class="btn-refresh" onclick="refreshAllData()">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Page Content Container -->
            <div class="page-container">
                <!-- Overview Page -->
                <div class="page-content active" id="overview-page">
                    <div class="overview-grid">
                        <!-- Quick Stats -->
                        <div class="stats-section">
                            <div class="section-header">
                                <h3>Today's Summary</h3>
                                <p class="section-subtitle">Real-time overview of restaurant operations</p>
                            </div>
                            <div class="stats-cards">
                                <div class="stat-card occupied">
                                    <div class="stat-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-number" id="occupied-count">0</span>
                                        <span class="stat-label">Occupied Tables</span>
                                    </div>
                                </div>
                                <div class="stat-card available">
                                    <div class="stat-icon">
                                        <i class="fas fa-chair"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-number" id="available-count">0</span>
                                        <span class="stat-label">Available Tables</span>
                                    </div>
                                </div>
                                <div class="stat-card orders">
                                    <div class="stat-icon">
                                        <i class="fas fa-receipt"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-number" id="orders-count">0</span>
                                        <span class="stat-label">Active Orders</span>
                                    </div>
                                </div>
                                <div class="stat-card alerts">
                                    <div class="stat-icon">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="stat-info">
                                        <span class="stat-number" id="alerts-count">0</span>
                                        <span class="stat-label">Customer Calls</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="activity-section">
                            <div class="section-header">
                                <h3>Recent Activity</h3>
                                <p class="section-subtitle">Latest orders and customer interactions</p>
                            </div>
                            <div class="activity-feed" id="activity-feed">
                                <!-- Activity items will be loaded dynamically via JavaScript -->
                                <div class="activity-item">
                                    <div class="activity-icon info">
                                        <i class="fas fa-info-circle"></i>
                                    </div>
                                    <div class="activity-content">
                                        <p>Loading recent activity...</p>
                                        <span class="activity-time">Now</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="quick-actions-section">
                            <div class="section-header">
                                <h3>Quick Actions</h3>
                                <p class="section-subtitle">Common tasks for efficient restaurant management</p>
                            </div>
                            <div class="action-buttons">
                                <button class="action-btn primary" onclick="window.dashboard.navigateToPageNew('tables')" title="View and manage all table statuses">
                                    <i class="fas fa-table"></i>
                                    <span>Manage Tables</span>
                                    <small>View all table statuses</small>
                                </button>
                                <button class="action-btn secondary" onclick="window.dashboard.navigateToPageNew('menu')" title="Update menu items and pricing">
                                    <i class="fas fa-utensils"></i>
                                    <span>Update Menu</span>
                                    <small>Modify menu items</small>
                                </button>
                                <button class="action-btn success" onclick="window.dashboard.clearAllAlerts()" title="Resolve all pending customer calls">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Clear All Alerts</span>
                                    <small>Resolve pending calls</small>
                                </button>
                                <button class="action-btn info" onclick="window.dashboard.navigateToPageNew('analytics')" title="View sales and performance reports">
                                    <i class="fas fa-chart-line"></i>
                                    <span>View Reports</span>
                                    <small>Sales & analytics</small>
                                </button>
                            </div>
                            <div class="keyboard-shortcuts">
                                <p><strong>💡 Tip:</strong> Use <kbd>Ctrl+1</kbd> for Overview, <kbd>Ctrl+2</kbd> for Tables, <kbd>Ctrl+3</kbd> for Orders, <kbd>Ctrl+R</kbd> to refresh</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tables Page -->
                <div class="page-content" id="tables-page">
                    <div class="page-header">
                        <h3>Table Management</h3>
                        <div class="page-actions">
                            <button class="btn-secondary" onclick="refreshTables()">
                                <i class="fas fa-sync-alt"></i>
                                Refresh Tables
                            </button>
                        </div>
                    </div>
                    <div class="tables-grid" id="tables-grid">
                        <!-- Tables will be loaded dynamically via JavaScript -->
                        <div class="loading-message">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Loading tables...</p>
                        </div>
                    </div>
                </div>

                <!-- Orders Page -->
                <div class="page-content" id="orders-page">
                    <div class="page-header">
                        <h3>Order Management</h3>
                        <div class="page-actions">
                            <div class="filter-buttons">
                                <button class="filter-btn active" data-status="all">All Orders</button>
                                <button class="filter-btn" data-status="pending">Pending</button>
                                <button class="filter-btn" data-status="preparing">Preparing</button>
                                <button class="filter-btn" data-status="ready">Ready</button>
                            </div>
                        </div>
                    </div>
                    <div class="orders-list" id="orders-list">
                        <!-- Orders will be loaded dynamically via JavaScript -->
                        <div class="loading-message">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Loading orders...</p>
                        </div>
                    </div>
                </div>

                <!-- Alerts Page -->
                <div class="page-content" id="alerts-page">
                    <div class="page-header">
                        <h3>Customer Calls & Alerts</h3>
                        <div class="page-actions">
                            <button class="btn-danger" onclick="clearAllAlerts()">
                                <i class="fas fa-trash"></i>
                                Clear All Alerts
                            </button>
                        </div>
                    </div>
                    <div class="alerts-list" id="alerts-list">
                        <!-- Alerts will be loaded dynamically via JavaScript -->
                        <div class="loading-message">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Loading alerts...</p>
                        </div>
                    </div>
                </div>

                <!-- Menu Page -->
                <div class="page-content" id="menu-page">
                    <div class="page-header">
                        <h3>Menu Management</h3>
                        <div class="page-actions">
                            <a href="/menu-management" class="btn-primary">
                                <i class="fas fa-external-link-alt"></i>
                                Full Menu Manager
                            </a>
                        </div>
                    </div>
                    <div class="menu-preview">
                        <p>Quick menu overview will be loaded here. Use the "Full Menu Manager" button to access complete menu management features.</p>
                    </div>
                </div>

                <!-- Analytics Page -->
                <div class="page-content" id="analytics-page">
                    <div class="page-header">
                        <h3>Analytics & Reports</h3>
                        <div class="page-actions">
                            <button class="btn-secondary" onclick="exportReports()">
                                <i class="fas fa-download"></i>
                                Export Report
                            </button>
                        </div>
                    </div>
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h4>Today's Sales</h4>
                            <div class="metric-large">$1,250.00</div>
                            <div class="metric-change positive">+12% from yesterday</div>
                        </div>
                        <div class="analytics-card">
                            <h4>Orders Completed</h4>
                            <div class="metric-large">45</div>
                            <div class="metric-change positive">+8% from yesterday</div>
                        </div>
                        <div class="analytics-card">
                            <h4>Average Order Value</h4>
                            <div class="metric-large">$27.78</div>
                            <div class="metric-change negative">-3% from yesterday</div>
                        </div>
                        <div class="analytics-card">
                            <h4>Customer Calls</h4>
                            <div class="metric-large">12</div>
                            <div class="metric-change neutral">Same as yesterday</div>
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div class="page-content" id="settings-page">
                    <div class="page-header">
                        <h3>Restaurant Settings</h3>
                    </div>
                    <div class="settings-sections">
                        <div class="settings-card">
                            <h4>Operating Hours</h4>
                            <p>Current: 11:00 AM - 11:00 PM Daily</p>
                            <button class="btn-secondary">Update Hours</button>
                        </div>
                        <div class="settings-card">
                            <h4>Table Configuration</h4>
                            <p>Manage table numbers and VIP designations</p>
                            <button class="btn-secondary">Configure Tables</button>
                        </div>
                        <div class="settings-card">
                            <h4>Staff Notifications</h4>
                            <p>Customize alert preferences and sounds</p>
                            <button class="btn-secondary">Notification Settings</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/staff-dashboard.js') }}"></script>
    <script>
        // Initialize Socket.IO connection separately
        let socket;
        
        function initializeSocket() {
            try {
                socket = io({
                    transports: ['polling', 'websocket'],
                    upgrade: true,
                    rememberUpgrade: false,
                    timeout: 20000,
                    forceNew: false,
                    autoConnect: true
                });
                
                socket.on('connect', function() {
                    console.log('✅ Socket.IO connected successfully');
                    if (window.dashboard) {
                        window.dashboard.handleSocketConnection(socket);
                    }
                });
                
                socket.on('connect_error', function(error) {
                    console.log('❌ Socket.IO connection error:', error);
                    // Fallback to polling mode or show notification
                });
                
                socket.on('disconnect', function() {
                    console.log('🔌 Socket.IO disconnected');
                });
                
                // Real-time event handlers
                socket.on('staff_alert', function(data) {
                    if (window.dashboard) {
                        window.dashboard.handleCustomerCall(data);
                    }
                });
                
                socket.on('order_update', function(data) {
                    if (window.dashboard) {
                        window.dashboard.handleOrderUpdate(data);
                    }
                });
                
                socket.on('table_update', function(data) {
                    if (window.dashboard) {
                        window.dashboard.handleTableUpdate(data);
                    }
                });
                
            } catch (error) {
                console.warn('Socket.IO initialization failed, continuing without real-time updates:', error);
            }
        }

        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the dashboard first
            if (typeof StaffDashboard !== 'undefined') {
                window.dashboard = new StaffDashboard();
            }
            
            // Initialize Socket.IO after a short delay
            setTimeout(initializeSocket, 500);
        });
    </script>
</body>
</html>