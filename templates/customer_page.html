<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Green Heaven - Menu</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/customer.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="customer-app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="restaurant-info">
                    <div class="brand-section">
                        <img src="{{ url_for('static', filename='logo.png') }}" alt="Green Heaven Logo" class="logo">
                        <div class="brand-text">
                            <h1>Green Heaven</h1>
                            <p>Katuneriya, Sri Lanka</p>
                            <small class="tagline">Where Nature Becomes Flavor</small>
                        </div>
                    </div>
                </div>
                <div class="customer-info">
                    <div class="welcome">
                        <span class="customer-name">{{ customer_name }}</span>
                        <span class="table-info">Table {{ table_number }}</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="call-staff-btn" id="call-staff-btn">
                <i class="fas fa-bell"></i>
                <span>Call Staff</span>
            </button>
            <button class="cart-btn" id="cart-btn">
                <i class="fas fa-shopping-cart"></i>
                <span>Cart (<span id="cart-count">0</span>)</span>
                <span class="cart-total">LKR <span id="cart-total">0.00</span></span>
            </button>
        </div>

        <!-- Menu Categories -->
        <div class="menu-categories">
            <button class="category-btn active" data-category="all">All Items</button>
            <button class="category-btn" data-category="Appetizers">Appetizers</button>
            <button class="category-btn" data-category="Main Course">Main Course</button>
            <button class="category-btn" data-category="Sri Lankan Specials">Sri Lankan Specials</button>
            <button class="category-btn" data-category="Desserts">Desserts</button>
            <button class="category-btn" data-category="Beverages">Beverages</button>
        </div>

        <!-- Menu Items -->
        <div class="menu-container">
            <div class="menu-grid" id="menu-grid">
                {% for item in menu_items %}
                <div class="menu-item" data-category="{{ item.category }}" data-item-id="{{ item.id }}">
                    <div class="menu-item-image">
                        {% if item.image %}
                        <img src="{{ item.image }}" alt="{{ item.name }}">
                        {% else %}
                        <div class="image-placeholder">
                            <i class="fas fa-utensils"></i>
                        </div>
                        {% endif %}
                    </div>
                    <div class="menu-item-content">
                        <h3 class="item-name">{{ item.name }}</h3>
                        <p class="item-description">{{ item.description }}</p>
                        <div class="item-footer">
                            <span class="item-price">LKR {{ "%.2f"|format(item.price) }}</span>
                            <div class="quantity-controls">
                                <button class="qty-btn minus" onclick="updateQuantity('{{ item.id }}', -1)">-</button>
                                <span class="quantity" id="qty-{{ item.id }}">0</span>
                                <button class="qty-btn plus" onclick="updateQuantity('{{ item.id }}', 1)">+</button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Cart Modal -->
        <div class="modal" id="cart-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-shopping-cart"></i> Your Order</h2>
                    <button class="close-modal" id="close-cart-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="cart-items"></div>
                    <div class="cart-summary">
                        <div class="total-row">
                            <strong>Total: LKR <span id="final-total">0.00</span></strong>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" id="close-cart-modal-btn">Continue Shopping</button>
                    <button class="btn-primary" id="place-order-btn">Place Order</button>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div class="modal" id="confirmation-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-check-circle"></i> Order Confirmed!</h2>
                </div>
                <div class="modal-body">
                    <p>Your order has been sent to the kitchen.</p>
                    <p>We'll notify you when it's ready!</p>
                    <div class="order-status">
                        <span id="order-status-text">Order Received</span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-primary" id="close-confirmation-btn">Continue</button>
                </div>
            </div>
        </div>

        <!-- Call Staff Success Modal -->
        <div class="modal" id="call-success-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-bell"></i> Staff Notified!</h2>
                </div>
                <div class="modal-body">
                    <p>Our staff has been notified and will be with you shortly.</p>
                    <p>Thank you for your patience!</p>
                </div>
                <div class="modal-footer">
                    <button class="btn-primary" id="close-call-success-btn">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio for notifications -->
    <audio id="notification-sound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwPKCKE3NrMeR8BMGw=" type="audio/wav">
    </audio>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        // Customer data
        const customerName = "{{ customer_name }}";
        const tableNumber = "{{ table_number }}";
        let menuItems = [];
        
        // Load menu items
        fetch('/api/menu')
            .then(response => response.json())
            .then(data => {
                menuItems = data;
            })
            .catch(error => console.error('Error loading menu:', error));
        
        // Cart data
        let cart = {};
        let orderStatus = null;
        
        // Initialize Socket.IO
        const socket = io();
        
        // Join customer room for order updates
        socket.emit('join_customer_room', { table_number: tableNumber });
        
        // Listen for order status updates
        socket.on('order_status_updated', function(data) {
            if (orderStatus && data.order_id === orderStatus.order_id) {
                updateOrderStatus(data.status);
                playNotificationSound();
            }
        });
    </script>
    <script src="{{ url_for('static', filename='js/customer.js') }}"></script>
</body>
</html>